<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>STEAM Lab Pro - Voice Hub</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap');
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Inter', sans-serif;
      overflow: hidden;
      background: #0f172a;
      height: 100vh;
      position: relative;
    }
    
    /* Animated gradient background */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, #1e40af 0%, #3b82f6 30%, #ec4899 70%, #f472b6 100%);
      opacity: 0.15;
      z-index: 0;
    }
    
    /* Animated particles */
    body::after {
      content: '';
      position: fixed;
      inset: 0;
      background-image: 
        radial-gradient(circle at 20% 50%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(236, 72, 153, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 20%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
      animation: particleFloat 20s ease-in-out infinite;
      z-index: 0;
    }
    
    @keyframes particleFloat {
      0%, 100% { transform: translate(0, 0) scale(1); }
      33% { transform: translate(30px, -30px) scale(1.1); }
      66% { transform: translate(-20px, 20px) scale(0.9); }
    }
    
    /* Hub Container */
    .hub-container {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }
    
    /* Top Bar */
    .top-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 70px;
      background: rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(59, 130, 246, 0.2);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 2rem;
      z-index: 100;
    }
    
    .logo-section {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .logo-icon {
      width: 45px;
      height: 45px;
      background: linear-gradient(135deg, #3b82f6, #ec4899);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
    }
    
    .logo-text h1 {
      font-size: 1.5rem;
      font-weight: 800;
      background: linear-gradient(135deg, #3b82f6, #ec4899);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .logo-text p {
      font-size: 0.75rem;
      color: rgba(255, 255, 255, 0.5);
      margin-top: -2px;
    }
    
    .status-section {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }
    
    .voice-status {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 20px;
      color: white;
      font-size: 0.875rem;
    }
    
    .voice-status.active {
      background: rgba(236, 72, 153, 0.2);
      border-color: rgba(236, 72, 153, 0.5);
      animation: pulse-border 2s infinite;
    }
    
    @keyframes pulse-border {
      0%, 100% { box-shadow: 0 0 0 0 rgba(236, 72, 153, 0.4); }
      50% { box-shadow: 0 0 0 8px rgba(236, 72, 153, 0); }
    }
    
    .status-indicator {
      width: 8px;
      height: 8px;
      background: #10b981;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    /* Central Circle - Large Single Button */
    .central-circle {
      position: relative;
      width: 320px;
      height: 320px;
      border-radius: 50%;
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.95), rgba(30, 41, 59, 0.95));
      backdrop-filter: blur(40px);
      border: 3px solid transparent;
      background-clip: padding-box;
      box-shadow: 
        0 0 0 1px rgba(59, 130, 246, 0.5),
        0 30px 80px rgba(0, 0, 0, 0.5),
        inset 0 0 60px rgba(59, 130, 246, 0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      animation: float 6s ease-in-out infinite;
      z-index: 100;
    }
    
    .central-circle::before {
      content: '';
      position: absolute;
      inset: -3px;
      border-radius: 50%;
      background: linear-gradient(135deg, #3b82f6, #ec4899, #8b5cf6);
      z-index: -1;
      opacity: 0.6;
      animation: rotate-border 8s linear infinite;
    }
    
    @keyframes rotate-border {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    /* Hover expands the circle */
    .central-circle:hover {
      transform: scale(1.3);
      width: 400px;
      height: 400px;
      box-shadow: 
        0 0 0 1px rgba(236, 72, 153, 0.8),
        0 40px 120px rgba(59, 130, 246, 0.5),
        inset 0 0 100px rgba(236, 72, 153, 0.3);
    }
    
    .central-circle:hover::before {
      opacity: 1;
    }
    
    .central-circle.listening {
      animation: pulse-glow 1.5s ease-in-out infinite, float 6s ease-in-out infinite;
      box-shadow: 
        0 0 0 1px rgba(236, 72, 153, 1),
        0 35px 100px rgba(236, 72, 153, 0.6),
        inset 0 0 80px rgba(236, 72, 153, 0.3);
    }
    
    .central-circle.listening::before {
      opacity: 1;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }
    
    @keyframes pulse-glow {
      0%, 100% { 
        box-shadow: 0 25px 70px rgba(236,72,153,0.6), 0 0 0 0 rgba(236,72,153,0.7);
        transform: scale(1);
      }
      50% { 
        box-shadow: 0 35px 100px rgba(236,72,153,0.9), 0 0 0 20px rgba(236,72,153,0);
        transform: scale(1.05);
      }
    }
    
    .central-icon {
      font-size: 5.5rem;
      background: linear-gradient(135deg, #3b82f6, #ec4899);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(0 8px 20px rgba(59, 130, 246, 0.4));
      animation: icon-pulse 3s ease-in-out infinite;
    }
    
    @keyframes icon-pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    .central-text {
      color: white;
      font-size: 2.2rem;
      font-weight: 900;
      letter-spacing: 0.05em;
      text-shadow: 0 4px 20px rgba(59, 130, 246, 0.5);
      margin-top: 1rem;
      background: linear-gradient(135deg, #fff, #e0e7ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .central-subtext {
      color: rgba(255, 255, 255, 0.6);
      font-size: 0.9rem;
      margin-top: 0.5rem;
      font-weight: 500;
      letter-spacing: 0.02em;
    }
    
    /* Tool Bubbles - Hidden by default, shown on central hover */
    .tool-bubble {
      position: absolute;
      width: 130px;
      height: 130px;
      border-radius: 50%;
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.9), rgba(30, 41, 59, 0.9));
      backdrop-filter: blur(30px);
      border: 2px solid rgba(59, 130, 246, 0.3);
      box-shadow: 
        0 10px 40px rgba(0, 0, 0, 0.4),
        inset 0 0 30px rgba(59, 130, 246, 0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      opacity: 0;
      transform: scale(0);
      pointer-events: none;
    }
    
    /* Show bubbles when hovering over the hub container */
    .hub-container:hover .tool-bubble {
      opacity: 1;
      pointer-events: auto;
    }
    
    /* Slide out animations for each bubble */
    .hub-container:hover .tool-bubble.bubble-1 {
      transform: translateX(-50%) scale(1);
      transition-delay: 0.1s;
    }
    
    .hub-container:hover .tool-bubble.bubble-2 {
      transform: scale(1);
      transition-delay: 0.15s;
    }
    
    .hub-container:hover .tool-bubble.bubble-3 {
      transform: translateY(-50%) scale(1);
      transition-delay: 0.2s;
    }
    
    .hub-container:hover .tool-bubble.bubble-4 {
      transform: scale(1);
      transition-delay: 0.25s;
    }
    
    .hub-container:hover .tool-bubble.bubble-5 {
      transform: translateX(-50%) scale(1);
      transition-delay: 0.3s;
    }
    
    .hub-container:hover .tool-bubble.bubble-6 {
      transform: scale(1);
      transition-delay: 0.35s;
    }
    
    .hub-container:hover .tool-bubble.bubble-7 {
      transform: translateY(-50%) scale(1);
      transition-delay: 0.4s;
    }
    
    .hub-container:hover .tool-bubble.bubble-8 {
      transform: scale(1);
      transition-delay: 0.45s;
    }
    
    .hub-container:hover .tool-bubble.bubble-9 {
      transform: scale(1);
      transition-delay: 0.5s;
    }
    
    .tool-bubble:hover {
      transform: scale(1.12);
      box-shadow: 
        0 15px 50px rgba(236, 72, 153, 0.4),
        0 0 40px rgba(59, 130, 246, 0.3),
        inset 0 0 40px rgba(236, 72, 153, 0.2);
      border-color: rgba(236, 72, 153, 0.6);
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.95));
    }
    
    .tool-bubble:hover .icon {
      transform: scale(1.1);
    }
    
    .tool-bubble .icon {
      font-size: 2.8rem;
      margin-bottom: 0.5rem;
      filter: drop-shadow(0 4px 12px rgba(59, 130, 246, 0.3));
      transition: all 0.3s ease;
    }
    
    .tool-bubble .label {
      color: rgba(255, 255, 255, 0.9);
      font-size: 0.8rem;
      font-weight: 600;
      text-align: center;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
      letter-spacing: 0.02em;
    }
    
    /* Bubble Positions - Circle around center (more spaced) */
    .bubble-1 { top: -180px; left: 50%; }
    .bubble-2 { top: -130px; right: -130px; }
    .bubble-3 { top: 50%; right: -180px; }
    .bubble-4 { bottom: -130px; right: -130px; }
    .bubble-5 { bottom: -180px; left: 50%; }
    .bubble-6 { bottom: -130px; left: -130px; }
    .bubble-7 { top: 50%; left: -180px; }
    .bubble-8 { top: -130px; left: -130px; }
    

    
    /* Content Panel */
    .content-panel {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.95);
      backdrop-filter: blur(20px);
      z-index: 200;
      display: none;
      overflow-y: auto;
      animation: slideDown 0.4s ease;
      padding: 2rem;
    }
    
    .content-panel.active {
      display: block;
    }
    
    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-50px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .panel-header {
      position: sticky;
      top: 0;
      background: rgba(0,0,0,0.9);
      backdrop-filter: blur(20px);
      padding: 2rem 2.5rem;
      margin: -2rem -2rem 2rem -2rem;
      border-bottom: 2px solid rgba(255,255,255,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 10;
    }
    
    .close-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, rgba(236,72,153,0.3), rgba(239,68,68,0.3));
      border: 2px solid rgba(236,72,153,0.6);
      color: #ec4899;
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .close-btn:hover {
      background: linear-gradient(135deg, rgba(236,72,153,0.5), rgba(239,68,68,0.5));
      transform: rotate(90deg) scale(1.1);
      box-shadow: 0 5px 20px rgba(236,72,153,0.5);
    }
    
    /* Voice Command Display */
    .voice-display {
      position: fixed;
      top: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, rgba(59,130,246,0.95), rgba(236,72,153,0.95));
      backdrop-filter: blur(20px);
      color: white;
      padding: 1rem 2.5rem;
      border-radius: 50px;
      font-size: 1.1rem;
      font-weight: 600;
      z-index: 300;
      display: none;
      border: 2px solid rgba(255,255,255,0.3);
      box-shadow: 0 10px 40px rgba(59,130,246,0.5), 0 5px 20px rgba(236,72,153,0.4);
    }
    
    .voice-display.show {
      display: block;
      animation: slideDown 0.3s ease;
    }
    
    /* Glass Card */
    .glass-card {
      background: linear-gradient(135deg, rgba(59,130,246,0.15), rgba(236,72,153,0.1));
      backdrop-filter: blur(20px);
      border-radius: 24px;
      border: 1px solid rgba(59,130,246,0.3);
      padding: 2.5rem;
      box-shadow: 0 10px 40px rgba(59,130,246,0.2), 0 5px 20px rgba(236,72,153,0.15);
      margin-bottom: 1.5rem;
    }
    
    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 10px; }
    ::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); }
    ::-webkit-scrollbar-thumb { 
      background: rgba(255,255,255,0.3); 
      border-radius: 5px; 
    }
    ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.5); }
    
    /* Animations for bubbles */
    .tool-bubble:nth-child(1) { animation-delay: 0.1s; }
    .tool-bubble:nth-child(2) { animation-delay: 0.2s; }
    .tool-bubble:nth-child(3) { animation-delay: 0.3s; }
    .tool-bubble:nth-child(4) { animation-delay: 0.4s; }
    .tool-bubble:nth-child(5) { animation-delay: 0.5s; }
    .tool-bubble:nth-child(6) { animation-delay: 0.6s; }
    .tool-bubble:nth-child(7) { animation-delay: 0.7s; }
    .tool-bubble:nth-child(8) { animation-delay: 0.8s; }
  </style>
</head>
<body>

  <!-- Top Bar -->
  <div class="top-bar">
    <div class="logo-section">
      <div class="logo-icon">üéØ</div>
      <div class="logo-text">
        <h1>STEAM Lab Pro</h1>
        <p>Advanced Learning Platform</p>
      </div>
    </div>
    
    <div class="status-section">
      <div id="voiceStatusBar" class="voice-status">
        <div class="status-indicator"></div>
        <span>Voice Control Ready</span>
      </div>
      <button onclick="toggleVoice()" class="px-4 py-2 bg-gradient-to-r from-blue-500 to-pink-500 text-white rounded-lg font-semibold hover:scale-105 transition">
        <i class="fas fa-microphone mr-2"></i>
        <span id="voiceToggleText">Activate</span>
      </button>
    </div>
  </div>
  
  <!-- Voice Command Display -->
  <div id="voiceDisplay" class="voice-display">
    <i class="fas fa-microphone mr-2"></i>
    <span id="voiceText">Listening...</span>
  </div>
  

  
  <!-- Main Hub -->
  <div class="hub-container">
    <div style="position: relative;">
      
      <!-- Central Circle -->
      <div id="centralCircle" class="central-circle" onclick="toggleVoice()">
        <div class="central-icon">üéØ</div>
        <div class="central-text">STEAM</div>
        <div class="central-subtext">Click or Say Command</div>
      </div>
      
      <!-- Tool Bubbles -->
      <div class="tool-bubble bubble-1" onclick="openTool('experiments')">
        <div class="icon">üß™</div>
        <div class="label">Experiments</div>
      </div>
      
      <div class="tool-bubble bubble-2" onclick="openTool('calculator')">
        <div class="icon">üî¢</div>
        <div class="label">Calculator</div>
      </div>
      
      <div class="tool-bubble bubble-3" onclick="openTool('tasks')">
        <div class="icon">‚úÖ</div>
        <div class="label">Tasks</div>
      </div>
      
      <div class="tool-bubble bubble-4" onclick="openTool('notes')">
        <div class="icon">üìù</div>
        <div class="label">Notes</div>
      </div>
      
      <div class="tool-bubble bubble-5" onclick="openTool('ai')">
        <div class="icon">ü§ñ</div>
        <div class="label">AI Tutor</div>
      </div>
      
      <div class="tool-bubble bubble-6" onclick="openTool('data')">
        <div class="icon">üìä</div>
        <div class="label">Data</div>
      </div>
      
      <div class="tool-bubble bubble-7" onclick="openTool('inventory')">
        <div class="icon">üì¶</div>
        <div class="label">Inventory</div>
      </div>
      
      <div class="tool-bubble bubble-8" onclick="openTool('calendar')">
        <div class="icon">üìÖ</div>
        <div class="label">Calendar</div>
      </div>
      
    </div>
  </div>

  <!-- Content Panels -->
  
  <!-- Experiments Panel -->
  <div id="panel-experiments" class="content-panel">
    <div class="panel-header">
      <h2 class="text-3xl font-bold text-white">üß™ PhET Experiments</h2>
      <button class="close-btn" onclick="closePanel()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="p-6">
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        
        <div class="glass-card">
          <h3 class="text-xl font-bold text-white mb-3">üîã Circuit Construction</h3>
          <iframe src="https://phet.colorado.edu/sims/html/circuit-construction-kit-dc/latest/circuit-construction-kit-dc_en.html" 
                  class="w-full h-64 rounded-lg mb-3"></iframe>
          <a href="https://phet.colorado.edu/sims/html/circuit-construction-kit-dc/latest/circuit-construction-kit-dc_en.html" 
             target="_blank" class="text-blue-300 hover:text-blue-200">
            <i class="fas fa-expand mr-2"></i>Fullscreen
          </a>
        </div>
        
        <div class="glass-card">
          <h3 class="text-xl font-bold text-white mb-3">üèÉ Forces & Motion</h3>
          <iframe src="https://phet.colorado.edu/sims/html/forces-and-motion-basics/latest/forces-and-motion-basics_en.html" 
                  class="w-full h-64 rounded-lg mb-3"></iframe>
          <a href="https://phet.colorado.edu/sims/html/forces-and-motion-basics/latest/forces-and-motion-basics_en.html" 
             target="_blank" class="text-blue-300 hover:text-blue-200">
            <i class="fas fa-expand mr-2"></i>Fullscreen
          </a>
        </div>
        
        <div class="glass-card">
          <h3 class="text-xl font-bold text-white mb-3">‚öñÔ∏è Balancing Act</h3>
          <iframe src="https://phet.colorado.edu/sims/html/balancing-act/latest/balancing-act_en.html" 
                  class="w-full h-64 rounded-lg mb-3"></iframe>
          <a href="https://phet.colorado.edu/sims/html/balancing-act/latest/balancing-act_en.html" 
             target="_blank" class="text-blue-300 hover:text-blue-200">
            <i class="fas fa-expand mr-2"></i>Fullscreen
          </a>
        </div>
        
        <div class="glass-card">
          <h3 class="text-xl font-bold text-white mb-3">üß™ Acid-Base Solutions</h3>
          <iframe src="https://phet.colorado.edu/sims/html/acid-base-solutions/latest/acid-base-solutions_en.html" 
                  class="w-full h-64 rounded-lg mb-3"></iframe>
          <a href="https://phet.colorado.edu/sims/html/acid-base-solutions/latest/acid-base-solutions_en.html" 
             target="_blank" class="text-blue-300 hover:text-blue-200">
            <i class="fas fa-expand mr-2"></i>Fullscreen
          </a>
        </div>
        
        <div class="glass-card">
          <h3 class="text-xl font-bold text-white mb-3">üéØ Projectile Motion</h3>
          <iframe src="https://phet.colorado.edu/sims/html/projectile-motion/latest/projectile-motion_en.html" 
                  class="w-full h-64 rounded-lg mb-3"></iframe>
          <a href="https://phet.colorado.edu/sims/html/projectile-motion/latest/projectile-motion_en.html" 
             target="_blank" class="text-blue-300 hover:text-blue-200">
            <i class="fas fa-expand mr-2"></i>Fullscreen
          </a>
        </div>
        
        <div class="glass-card">
          <h3 class="text-xl font-bold text-white mb-3">üõπ Energy Skate Park</h3>
          <iframe src="https://phet.colorado.edu/sims/html/energy-skate-park/latest/energy-skate-park_en.html" 
                  class="w-full h-64 rounded-lg mb-3"></iframe>
          <a href="https://phet.colorado.edu/sims/html/energy-skate-park/latest/energy-skate-park_en.html" 
             target="_blank" class="text-blue-300 hover:text-blue-200">
            <i class="fas fa-expand mr-2"></i>Fullscreen
          </a>
        </div>
        
      </div>
    </div>
  </div>

  <!-- Calculator Panel -->
  <div id="panel-calculator" class="content-panel">
    <div class="panel-header">
      <h2 class="text-3xl font-bold text-white">üî¢ Calculator</h2>
      <button class="close-btn" onclick="closePanel()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="p-8 flex items-center justify-center min-h-screen">
      <div class="glass-card max-w-md w-full">
        <div class="bg-black/50 rounded-xl p-8 mb-8">
          <input type="text" id="calcDisplay" readonly 
                 class="w-full bg-transparent text-white text-4xl text-right outline-none" value="0">
        </div>
        
        <div class="grid grid-cols-4 gap-4">
          <button onclick="calcInput('7')" class="calc-btn">7</button>
          <button onclick="calcInput('8')" class="calc-btn">8</button>
          <button onclick="calcInput('9')" class="calc-btn">9</button>
          <button onclick="calcInput('/')" class="calc-btn-op">√∑</button>
          
          <button onclick="calcInput('4')" class="calc-btn">4</button>
          <button onclick="calcInput('5')" class="calc-btn">5</button>
          <button onclick="calcInput('6')" class="calc-btn">6</button>
          <button onclick="calcInput('*')" class="calc-btn-op">√ó</button>
          
          <button onclick="calcInput('1')" class="calc-btn">1</button>
          <button onclick="calcInput('2')" class="calc-btn">2</button>
          <button onclick="calcInput('3')" class="calc-btn">3</button>
          <button onclick="calcInput('-')" class="calc-btn-op">‚àí</button>
          
          <button onclick="calcInput('0')" class="calc-btn">0</button>
          <button onclick="calcInput('.')" class="calc-btn">.</button>
          <button onclick="calcEqual()" class="calc-btn-eq">=</button>
          <button onclick="calcInput('+')" class="calc-btn-op">+</button>
          
          <button onclick="calcClear()" class="calc-btn-clear col-span-4">Clear</button>
        </div>
      </div>
    </div>
  </div>
  
  <style>
    .calc-btn, .calc-btn-op, .calc-btn-eq, .calc-btn-clear {
      padding: 1.5rem;
      border: none;
      border-radius: 15px;
      font-size: 1.5rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .calc-btn {
      background: linear-gradient(135deg, rgba(59,130,246,0.3), rgba(236,72,153,0.2));
      color: white;
      border: 1px solid rgba(59,130,246,0.4);
    }
    
    .calc-btn-op {
      background: linear-gradient(135deg, rgba(59,130,246,0.6), rgba(147,51,234,0.5));
      color: white;
    }
    
    .calc-btn-eq {
      background: linear-gradient(135deg, rgba(236,72,153,0.6), rgba(219,39,119,0.5));
      color: white;
    }
    
    .calc-btn-clear {
      background: linear-gradient(135deg, rgba(239,68,68,0.5), rgba(220,38,38,0.5));
      color: white;
    }
    
    .calc-btn:hover, .calc-btn-op:hover, .calc-btn-eq:hover, .calc-btn-clear:hover {
      transform: scale(1.05);
      filter: brightness(1.2);
    }
    
    .calc-btn:active, .calc-btn-op:active, .calc-btn-eq:active, .calc-btn-clear:active {
      transform: scale(0.95);
    }
  </style>

  <!-- Tasks Panel -->
  <div id="panel-tasks" class="content-panel">
    <div class="panel-header">
      <h2 class="text-3xl font-bold text-white">‚úÖ My Tasks</h2>
      <button class="close-btn" onclick="closePanel()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="p-8">
      
      <!-- Task Input Form -->
      <div class="glass-card max-w-4xl mx-auto mb-8">
        <h3 class="text-xl font-bold text-white mb-4">Add New Task</h3>
        <div class="grid md:grid-cols-2 gap-4 mb-4">
          <input type="text" id="taskInput" placeholder="Task title..." 
                 class="px-4 py-3 bg-white/10 text-white placeholder-white/50 rounded-xl border border-white/30 focus:outline-none focus:border-white/60">
          
          <select id="taskCategory" class="px-4 py-3 bg-white/10 text-white rounded-xl border border-white/30 focus:outline-none focus:border-white/60">
            <option value="homework">üìö Homework</option>
            <option value="project">üéØ Project</option>
            <option value="study">üìñ Study</option>
            <option value="exam">üìù Exam</option>
            <option value="other">üìå Other</option>
          </select>
        </div>
        
        <div class="grid md:grid-cols-3 gap-4 mb-4">
          <select id="taskPriority" class="px-4 py-3 bg-white/10 text-white rounded-xl border border-white/30 focus:outline-none focus:border-white/60">
            <option value="low">üü¢ Low Priority</option>
            <option value="medium">üü° Medium Priority</option>
            <option value="high">üî¥ High Priority</option>
          </select>
          
          <input type="date" id="taskDueDate" 
                 class="px-4 py-3 bg-white/10 text-white rounded-xl border border-white/30 focus:outline-none focus:border-white/60">
          
          <input type="time" id="taskDueTime" 
                 class="px-4 py-3 bg-white/10 text-white rounded-xl border border-white/30 focus:outline-none focus:border-white/60">
        </div>
        
        <textarea id="taskDescription" placeholder="Task description (optional)..." rows="2"
                  class="w-full px-4 py-3 bg-white/10 text-white placeholder-white/50 rounded-xl border border-white/30 focus:outline-none focus:border-white/60 mb-4"></textarea>
        
        <button onclick="addTask()" class="w-full px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-bold hover:scale-105 transition">
          <i class="fas fa-plus mr-2"></i>Add Task
        </button>
      </div>
      
      <!-- Task Filters -->
      <div class="glass-card max-w-4xl mx-auto mb-8">
        <div class="flex flex-wrap gap-3">
          <button onclick="filterTasks('all')" class="filter-btn active" data-filter="all">
            All Tasks
          </button>
          <button onclick="filterTasks('active')" class="filter-btn" data-filter="active">
            Active
          </button>
          <button onclick="filterTasks('completed')" class="filter-btn" data-filter="completed">
            Completed
          </button>
          <button onclick="filterTasks('high')" class="filter-btn" data-filter="high">
            üî¥ High Priority
          </button>
          <button onclick="filterTasks('homework')" class="filter-btn" data-filter="homework">
            üìö Homework
          </button>
          <button onclick="filterTasks('project')" class="filter-btn" data-filter="project">
            üéØ Projects
          </button>
        </div>
      </div>
      
      <!-- Task List -->
      <div class="max-w-4xl mx-auto">
        <div id="taskList" class="space-y-4">
          <p class="text-white/60 text-center py-8">No tasks yet. Add one above!</p>
        </div>
      </div>
      
    </div>
  </div>
  
  <style>
    .filter-btn {
      px-4 py-2 bg-white/10 text-white rounded-lg border border-white/20 transition hover:bg-white/20;
      padding: 0.5rem 1rem;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border-radius: 0.5rem;
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 600;
    }
    
    .filter-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.05);
    }
    
    .filter-btn.active {
      background: linear-gradient(135deg, #3b82f6, #ec4899);
      border-color: transparent;
    }
    
    .task-card {
      background: linear-gradient(135deg, rgba(59,130,246,0.1), rgba(236,72,153,0.05));
      backdrop-filter: blur(20px);
      border-radius: 16px;
      border: 1px solid rgba(59,130,246,0.3);
      padding: 1.5rem;
      transition: all 0.3s;
    }
    
    .task-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(59,130,246,0.3);
    }
    
    .task-card.completed {
      opacity: 0.6;
      border-color: rgba(16, 185, 129, 0.3);
    }
    
    .priority-high {
      border-left: 4px solid #ef4444;
    }
    
    .priority-medium {
      border-left: 4px solid #f59e0b;
    }
    
    .priority-low {
      border-left: 4px solid #10b981;
    }
  </style>
  
  <!-- Notes Panel -->
  <div id="panel-notes" class="content-panel">
    <div class="panel-header">
      <h2 class="text-3xl font-bold text-white">üìù My Notes</h2>
      <button class="close-btn" onclick="closePanel()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="p-8">
      <div class="glass-card max-w-4xl mx-auto mb-8">
        <input type="text" id="noteTitle" placeholder="Note title..." 
               class="w-full px-4 py-3 bg-white/10 text-white placeholder-white/50 rounded-xl border border-white/30 focus:outline-none focus:border-white/60 mb-3">
        <textarea id="noteContent" placeholder="Write your note here..." rows="5"
                  class="w-full px-4 py-3 bg-white/10 text-white placeholder-white/50 rounded-xl border border-white/30 focus:outline-none focus:border-white/60 mb-3"></textarea>
        <button onclick="addNote()" class="px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-bold hover:scale-105 transition">
          <i class="fas fa-save mr-2"></i>Save Note
        </button>
      </div>
      
      <div id="notesList" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        <p class="text-white/60 text-center py-8 col-span-full">No notes yet. Create one above!</p>
      </div>
    </div>
  </div>

  <!-- AI Panel -->
  <div id="panel-ai" class="content-panel">
    <div class="panel-header">
      <div class="flex items-center gap-3">
        <i class="fas fa-robot text-3xl text-purple-400 animate-pulse"></i>
        <div>
          <h2 class="text-3xl font-bold text-white">AI Tutor üõ°Ô∏è</h2>
          <p class="text-sm text-white/70">Voice-Enabled ‚Ä¢ Safe for Students ‚Ä¢ Powered by Groq AI</p>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <button id="aiVoiceBtn" onclick="toggleAIVoice()" 
                class="px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-xl transition flex items-center gap-2">
          <i class="fas fa-microphone"></i>
          <span>Voice</span>
        </button>
        <button class="close-btn" onclick="closePanel()">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
    
    <div class="flex flex-col h-full">
      <!-- Warning Banner -->
      <div class="bg-gradient-to-r from-yellow-600/30 to-orange-600/30 border-l-4 border-yellow-500 p-4 mx-8 mt-6 rounded-lg">
        <div class="flex items-start gap-3">
          <i class="fas fa-exclamation-triangle text-yellow-400 text-2xl mt-1"></i>
          <div>
            <h3 class="text-white font-bold text-lg mb-2">‚ö†Ô∏è Supervision Required</h3>
            <p class="text-white/90 text-sm leading-relaxed">
              This AI tool requires adult supervision. AI responses may contain errors or inappropriate content. 
              Teachers/parents should monitor all interactions. This tool guides learning but does not replace human instruction.
              <strong class="text-yellow-300">Always verify AI responses with trusted sources.</strong>
            </p>
          </div>
        </div>
      </div>
      
      <!-- Chat Messages -->
      <div id="aiChatMessages" class="flex-1 overflow-y-auto p-8 space-y-6">
        <div class="flex items-start gap-3">
          <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
            <i class="fas fa-robot text-white"></i>
          </div>
          <div class="glass-card max-w-2xl">
            <p class="text-white">
              üìö STEAM Education Information System
              
              This tool provides factual information about:
              ‚Ä¢ Science ‚Ä¢ Technology ‚Ä¢ Engineering ‚Ä¢ Arts ‚Ä¢ Mathematics
              
              I guide learning by helping you understand concepts, not by giving direct answers.
              Enter questions to receive educational guidance.
            </p>
          </div>
        </div>
      </div>

      <!-- Input Area -->
      <div class="border-t border-white/20 p-8 bg-black/30">
        <div class="flex items-center gap-3 max-w-4xl mx-auto">
          <button onclick="startAIVoiceInput()" 
                  class="w-12 h-12 bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white rounded-full flex items-center justify-center transition hover:scale-110 shadow-lg"
                  title="Click to speak">
            <i class="fas fa-microphone text-xl"></i>
          </button>
          <input type="text" id="aiChatInput" placeholder="Type your question or click the mic to speak..."
                 class="flex-1 px-4 py-3 bg-white/10 text-white placeholder-white/50 rounded-xl border border-white/30 focus:outline-none focus:border-white/60"
                 onkeypress="if(event.key==='Enter') sendAIChatMessage()">
          <button onclick="sendAIChatMessage()" 
                  class="w-12 h-12 bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 text-white rounded-full flex items-center justify-center transition hover:scale-110 shadow-lg">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>
        <p class="text-xs text-white/60 mt-3 text-center">
          üí° Tip: Click the microphone to speak your question!
        </p>
      </div>
    </div>
  </div>
  
  <!-- Data Panel -->
  <div id="panel-data" class="content-panel">
    <div class="panel-header">
      <h2 class="text-3xl font-bold text-white">üìä Data Visualization</h2>
      <button class="close-btn" onclick="closePanel()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="p-8">
      <div class="glass-card max-w-4xl mx-auto">
        <canvas id="dataChart" class="w-full" height="300"></canvas>
      </div>
      
      <div class="grid md:grid-cols-3 gap-8 mt-8">
        <div class="glass-card text-center">
          <div class="text-5xl mb-3">üß™</div>
          <p class="text-white/70 text-sm mb-2">Experiments</p>
          <p class="text-4xl font-bold text-white" id="statExperiments">0</p>
        </div>
        <div class="glass-card text-center">
          <div class="text-5xl mb-3">‚úÖ</div>
          <p class="text-white/70 text-sm mb-2">Tasks Done</p>
          <p class="text-4xl font-bold text-white" id="statTasks">0</p>
        </div>
        <div class="glass-card text-center">
          <div class="text-5xl mb-3">ü§ñ</div>
          <p class="text-white/70 text-sm mb-2">AI Chats</p>
          <p class="text-4xl font-bold text-white" id="statAI">0</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Resources Panel -->
  <div id="panel-resources" class="content-panel">
    <div class="panel-header">
      <h2 class="text-3xl font-bold text-white">üìö Learning Resources</h2>
      <button class="close-btn" onclick="closePanel()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="p-8">
      <div class="grid md:grid-cols-2 gap-8 max-w-5xl mx-auto">
        
        <div class="glass-card">
          <h3 class="text-2xl font-bold text-white mb-4">üî¨ Science</h3>
          <ul class="space-y-3 text-white/90">
            <li><a href="https://www.khanacademy.org/science" target="_blank" class="hover:text-blue-300 flex items-center">
              <i class="fas fa-external-link-alt mr-2"></i>Khan Academy Science
            </a></li>
            <li><a href="https://phet.colorado.edu/" target="_blank" class="hover:text-blue-300 flex items-center">
              <i class="fas fa-external-link-alt mr-2"></i>PhET Simulations
            </a></li>
            <li><a href="https://www.nasa.gov/stem" target="_blank" class="hover:text-blue-300 flex items-center">
              <i class="fas fa-external-link-alt mr-2"></i>NASA STEM
            </a></li>
          </ul>
        </div>
        
        <div class="glass-card">
          <h3 class="text-2xl font-bold text-white mb-4">üíª Technology</h3>
          <ul class="space-y-3 text-white/90">
            <li><a href="https://www.codecademy.com/" target="_blank" class="hover:text-blue-300 flex items-center">
              <i class="fas fa-external-link-alt mr-2"></i>Codecademy
            </a></li>
            <li><a href="https://scratch.mit.edu/" target="_blank" class="hover:text-blue-300 flex items-center">
              <i class="fas fa-external-link-alt mr-2"></i>Scratch Programming
            </a></li>
            <li><a href="https://www.freecodecamp.org/" target="_blank" class="hover:text-blue-300 flex items-center">
              <i class="fas fa-external-link-alt mr-2"></i>freeCodeCamp
            </a></li>
          </ul>
        </div>
        
        <div class="glass-card">
          <h3 class="text-2xl font-bold text-white mb-4">‚öôÔ∏è Engineering</h3>
          <ul class="space-y-3 text-white/90">
            <li><a href="https://www.tinkercad.com/" target="_blank" class="hover:text-blue-300 flex items-center">
              <i class="fas fa-external-link-alt mr-2"></i>Tinkercad
            </a></li>
            <li><a href="https://www.arduino.cc/" target="_blank" class="hover:text-blue-300 flex items-center">
              <i class="fas fa-external-link-alt mr-2"></i>Arduino
            </a></li>
            <li><a href="https://www.instructables.com/" target="_blank" class="hover:text-blue-300 flex items-center">
              <i class="fas fa-external-link-alt mr-2"></i>Instructables
            </a></li>
          </ul>
        </div>
        
        <div class="glass-card">
          <h3 class="text-2xl font-bold text-white mb-4">üìê Mathematics</h3>
          <ul class="space-y-3 text-white/90">
            <li><a href="https://www.khanacademy.org/math" target="_blank" class="hover:text-blue-300 flex items-center">
              <i class="fas fa-external-link-alt mr-2"></i>Khan Academy Math
            </a></li>
            <li><a href="https://www.desmos.com/" target="_blank" class="hover:text-blue-300 flex items-center">
              <i class="fas fa-external-link-alt mr-2"></i>Desmos Graphing
            </a></li>
            <li><a href="https://www.wolframalpha.com/" target="_blank" class="hover:text-blue-300 flex items-center">
              <i class="fas fa-external-link-alt mr-2"></i>Wolfram Alpha
            </a></li>
          </ul>
        </div>
        
      </div>
    </div>
  </div>
  
  <!-- Plagiarism Checker Panel -->
  <div id="panel-plagiarism" class="content-panel">
    <div class="panel-header">
      <h2 class="text-3xl font-bold text-white">üîç Plagiarism Checker</h2>
      <button class="close-btn" onclick="closePanel()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="p-8">
      <p class="text-white/70 text-center mb-8">Check your text for plagiarism and get cited sources powered by Groq AI</p>
      
      <!-- Input Section -->
      <div class="glass-card max-w-4xl mx-auto mb-8">
        <label class="block text-xl font-bold text-white mb-4">üìù Enter your text to check:</label>
        <textarea id="plagiarismInput" placeholder="Paste your text here to check for plagiarism and find citations..." rows="10"
                  class="w-full px-4 py-3 bg-white/10 text-white placeholder-white/50 rounded-xl border border-white/30 focus:outline-none focus:border-white/60 mb-4"></textarea>
        
        <div class="flex gap-4">
          <button onclick="checkPlagiarism()" id="plagiarismCheckBtn" class="flex-1 px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-bold hover:scale-105 transition">
            <i class="fas fa-search mr-2"></i>Check for Plagiarism
          </button>
          <button onclick="clearPlagiarism()" class="px-6 py-3 bg-white/10 text-white rounded-xl font-bold hover:bg-white/20 transition">
            <i class="fas fa-trash mr-2"></i>Clear
          </button>
        </div>
      </div>
      
      <!-- Loading -->
      <div id="plagiarismLoading" class="glass-card max-w-4xl mx-auto text-center hidden">
        <div class="inline-block w-16 h-16 border-4 border-white/20 border-t-white rounded-full animate-spin mb-4"></div>
        <p class="text-white text-lg">Analyzing text and searching for sources...</p>
      </div>
      
      <!-- Error -->
      <div id="plagiarismError" class="glass-card max-w-4xl mx-auto bg-red-500/20 border-red-500/50 hidden">
        <p class="text-white text-center"></p>
      </div>
      
      <!-- Results -->
      <div id="plagiarismResults" class="max-w-4xl mx-auto hidden">
        <!-- Score Card -->
        <div class="glass-card text-center mb-8">
          <h3 class="text-2xl font-bold text-white mb-4">Plagiarism Score</h3>
          <div id="plagiarismScore" class="text-8xl font-bold text-white mb-4">0%</div>
          <p id="plagiarismStatus" class="text-xl text-white/80">Original Content</p>
        </div>
        
        <!-- Citations -->
        <div class="glass-card">
          <h3 class="text-2xl font-bold text-white mb-6">üìö Found Citations & Sources</h3>
          <div id="plagiarismCitations" class="space-y-4"></div>
        </div>
      </div>
      
    </div>
  </div>
  
  <!-- Inventory Panel -->
  <div id="panel-inventory" class="content-panel">
    <div class="panel-header">
      <h2 class="text-3xl font-bold text-white">üì¶ Inventory System</h2>
      <button class="close-btn" onclick="closePanel()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="p-8">
      <p class="text-white/70 text-center mb-8">See the current inventory status</p>
      
      <!-- Google Sheets Embed -->
      <div class="glass-card max-w-6xl mx-auto mb-8">
        <div class="rounded-xl overflow-hidden">
          <iframe
            src="https://docs.google.com/spreadsheets/d/e/2PACX-1vT69V_82_1Z2HaTDU-gspsccpc4e3cnJ77mpEHmZ9aplSx_xdRSzr-Ygw7xnT1zraWwp_gYBs2spNqb/pubhtml?widget=true&amp;headers=false"
            class="w-full h-[600px] border-0">
          </iframe>
        </div>
      </div>
      
      <!-- Navigation Buttons -->
      <div class="flex flex-wrap justify-center gap-4 max-w-4xl mx-auto">
        <button onclick="openInventorySheet('input')" class="px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl font-bold hover:scale-105 transition shadow-lg">
          <i class="fas fa-plus mr-2"></i>InPut
        </button>
        <button onclick="openInventorySheet('borrow')" class="px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-bold hover:scale-105 transition shadow-lg">
          <i class="fas fa-exchange-alt mr-2"></i>BorrowReturn
        </button>
        <button onclick="openInventorySheet('warehouse')" class="px-6 py-3 bg-gradient-to-r from-pink-500 to-red-500 text-white rounded-xl font-bold hover:scale-105 transition shadow-lg">
          <i class="fas fa-warehouse mr-2"></i>Warehouses
        </button>
        <button onclick="openInventorySheet('check')" class="px-6 py-3 bg-gradient-to-r from-green-500 to-teal-500 text-white rounded-xl font-bold hover:scale-105 transition shadow-lg">
          <i class="fas fa-search mr-2"></i>Check Item
        </button>
      </div>
    </div>
  </div>
  
  <!-- Calendar Panel -->
  <div id="panel-calendar" class="content-panel">
    <div class="panel-header">
      <h2 class="text-3xl font-bold text-white">üìÖ Smart Academic Calendar</h2>
      <button class="close-btn" onclick="closePanel()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="p-6">
      <p class="text-white/70 text-center mb-6">Google Calendar integration with intelligent reminders</p>
      
      <!-- Calendar Container - Full Width -->
      <div class="w-full mb-8">
        <div class="glass-card">
          <div class="overflow-hidden rounded-xl">
            <iframe
              src="https://calendar.google.com/calendar/embed?src=4fc31f36c20f654e12fbd6bc4bca5cc2926f1764a8266a136bd71bdf835af5da%40group.calendar.google.com&ctz=Asia%2FHo_Chi_Minh"
              class="w-full border-0" width="100%" height="600" frameborder="0" scrolling="no">
            </iframe>
          </div>
        </div>
      </div>

      <!-- Events and Reminders -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="glass-card">
          <h3 class="text-lg font-semibold mb-4 flex items-center text-white">
            <span class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center mr-3">
              <i class="fas fa-calendar text-white text-sm"></i>
            </span>
            üìÖ Upcoming Events
          </h3>
          <div id="upcomingEvents" class="space-y-3 max-h-70 overflow-y-auto">
            <div class="text-white/60 text-sm">WRO 2025 !!!</div>
          </div>
        </div>

        <div class="glass-card">
          <h3 class="text-lg font-semibold mb-4 flex items-center text-white">
            <span class="w-8 h-8 bg-gradient-to-r from-green-500 to-emerald-600 rounded-lg flex items-center justify-center mr-3">
              <i class="fas fa-clock text-white text-sm"></i>
            </span>
            ‚è∞ Today's Schedule
          </h3>
          <div id="todaySchedule" class="space-y-3 max-h-64 overflow-y-auto">
            <div class="text-white/60 text-sm">WRO 2025 !!!</div>
          </div>
        </div>

        <div class="glass-card">
          <h3 class="text-lg font-semibold mb-4 flex items-center text-white">
            <span class="w-8 h-8 bg-gradient-to-r from-red-500 to-pink-600 rounded-lg flex items-center justify-center mr-3">
              <i class="fas fa-bell text-white text-sm"></i>
            </span>
            üîî Active Reminders
          </h3>
          <div id="activeReminders" class="space-y-3 max-h-64 overflow-y-auto">
            <div class="text-white/60 text-sm">WRO 2025 !!!</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Voice Recognition - Manual Activation Only
    let recognition;
    let isListening = false;
    
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.continuous = true;
      recognition.interimResults = false;
      recognition.lang = 'en-US';
      
      recognition.onresult = (event) => {
        const last = event.results.length - 1;
        const command = event.results[last][0].transcript.toLowerCase();
        showVoiceCommand(command);
        processVoiceCommand(command);
      };
      
      recognition.onerror = (event) => {
        console.error('Speech error:', event.error);
        // Only auto-restart if it's not a permission issue
        if (event.error !== 'aborted' && event.error !== 'not-allowed' && event.error !== 'service-not-allowed') {
          if (isListening) {
            setTimeout(() => {
              try {
                recognition.start();
              } catch (e) {
                console.log('Recognition restart failed');
              }
            }, 1000);
          }
        } else {
          // Permission denied - stop trying
          stopListening();
        }
      };
      
      recognition.onend = () => {
        if (isListening) {
          setTimeout(() => {
            try {
              recognition.start();
            } catch (e) {
              console.log('Recognition restart failed');
            }
          }, 500);
        }
      };
    }
    
    function toggleVoice() {
      if (!recognition) {
        alert('Voice recognition not supported. Try Chrome or Edge.');
        return;
      }
      
      if (isListening) {
        stopListening();
      } else {
        startListening();
      }
    }
    
    function startListening() {
      try {
        recognition.start();
        isListening = true;
        document.getElementById('centralCircle').classList.add('listening');
        document.getElementById('voiceStatusBar').classList.add('active');
        document.getElementById('voiceStatusBar').querySelector('span').textContent = 'Voice Active';
        document.getElementById('voiceToggleText').textContent = 'Deactivate';
        showVoiceCommand('üé§ Always Listening...');
      } catch (e) {
        console.log('Recognition already started');
        isListening = true;
        document.getElementById('centralCircle').classList.add('listening');
        document.getElementById('voiceStatusBar').classList.add('active');
        document.getElementById('voiceStatusBar').querySelector('span').textContent = 'Voice Active';
        document.getElementById('voiceToggleText').textContent = 'Deactivate';
      }
    }
    
    function stopListening() {
      if (recognition) recognition.stop();
      isListening = false;
      document.getElementById('centralCircle').classList.remove('listening');
      document.getElementById('voiceStatusBar').classList.remove('active');
      document.getElementById('voiceStatusBar').querySelector('span').textContent = 'Voice Control Ready';
      document.getElementById('voiceToggleText').textContent = 'Activate';
      showVoiceCommand('Voice control stopped');
    }
    
    function showVoiceCommand(text) {
      const display = document.getElementById('voiceDisplay');
      const textEl = document.getElementById('voiceText');
      textEl.textContent = text;
      display.classList.add('show');
      
      setTimeout(() => {
        display.classList.remove('show');
      }, 3000);
    }
    
    function processVoiceCommand(command) {
      if (command.includes('experiment') || command.includes('lab') || command.includes('science')) {
        openTool('experiments');
      } else if (command.includes('calculator') || command.includes('calculate') || command.includes('math')) {
        openTool('calculator');
      } else if (command.includes('task') || command.includes('todo')) {
        openTool('tasks');
      } else if (command.includes('note')) {
        openTool('notes');
      } else if (command.includes('ai') || command.includes('tutor') || command.includes('help')) {
        openTool('ai');
      } else if (command.includes('data') || command.includes('chart') || command.includes('stat')) {
        openTool('data');
      } else if (command.includes('resource') || command.includes('link')) {
        openTool('resources');
      } else if (command.includes('calendar') || command.includes('schedule')) {
        openTool('calendar');
      } else if (command.includes('close') || command.includes('back') || command.includes('home')) {
        closePanel();
      } else {
        showVoiceCommand('Try: "open experiments" or "show calculator"');
      }
    }
    

    
    // Panel Management
    let currentPanel = null;
    let wasListeningBeforePanel = false;
    
    function openTool(toolName) {
      closePanel();
      currentPanel = toolName;
      document.getElementById(`panel-${toolName}`).classList.add('active');
      
      // PAUSE main navigation voice when opening AI panel
      if (toolName === 'ai' && isListening) {
        wasListeningBeforePanel = true;
        stopListening();
      }
      
      // Update stats
      if (toolName === 'experiments') updateStat('experiments');
      if (toolName === 'ai') updateStat('ai');
    }
    
    function closePanel() {
      if (currentPanel) {
        document.getElementById(`panel-${currentPanel}`).classList.remove('active');
        
        // RESUME main navigation voice when closing AI panel
        if (currentPanel === 'ai' && wasListeningBeforePanel) {
          setTimeout(() => startListening(), 500);
          wasListeningBeforePanel = false;
        }
        
        currentPanel = null;
      }
    }
    
    // Text-to-Speech for tool names
    function speakToolName(toolName) {
      if ('speechSynthesis' in window) {
        // Cancel any ongoing speech
        window.speechSynthesis.cancel();
        
        const utterance = new SpeechSynthesisUtterance(toolName);
        utterance.rate = 1.0;
        utterance.pitch = 1.0;
        utterance.volume = 1.0;
        window.speechSynthesis.speak(utterance);
      }
    }
    
    // Add speech to all bubbles
    document.addEventListener('DOMContentLoaded', () => {
      const bubbleData = [
        { selector: '.bubble-1', name: 'Experiments' },
        { selector: '.bubble-2', name: 'Calculator' },
        { selector: '.bubble-3', name: 'Tasks' },
        { selector: '.bubble-4', name: 'Notes' },
        { selector: '.bubble-5', name: 'AI Tutor' },
        { selector: '.bubble-6', name: 'Data Visualization' },
        { selector: '.bubble-7', name: 'Inventory System' },
        { selector: '.bubble-8', name: 'Calendar' }
      ];
      
      bubbleData.forEach(bubble => {
        const element = document.querySelector(bubble.selector);
        if (element) {
          element.addEventListener('mouseenter', () => speakToolName(bubble.name));
        }
      });
      
      // Fix plagiarism icon if broken
      const plagBubble = document.querySelector('.bubble-7 .icon');
      if (plagBubble && plagBubble.textContent.includes('?')) {
        plagBubble.textContent = 'üîç';
      }
    });
    
    // Bubbles are hidden by default - NO initial animation needed
    window.addEventListener('DOMContentLoaded', () => {
      // Bubbles will only show on hover over central circle
      
      initDataChart();
      loadData();
      
      // Voice must be manually activated by user
    });
    
    // Calculator
    let calcValue = '0';
    
    function calcInput(value) {
      if (calcValue === '0' || calcValue === 'Error') {
        calcValue = value;
      } else {
        calcValue += value;
      }
      document.getElementById('calcDisplay').value = calcValue;
    }
    
    function calcEqual() {
      try {
        calcValue = eval(calcValue).toString();
        document.getElementById('calcDisplay').value = calcValue;
      } catch (e) {
        calcValue = 'Error';
        document.getElementById('calcDisplay').value = calcValue;
      }
    }
    
    function calcClear() {
      calcValue = '0';
      document.getElementById('calcDisplay').value = calcValue;
    }
    
    // Tasks with Multi-features
    let tasks = [];
    let currentFilter = 'all';
    
    function addTask() {
      const title = document.getElementById('taskInput').value.trim();
      const category = document.getElementById('taskCategory').value;
      const priority = document.getElementById('taskPriority').value;
      const dueDate = document.getElementById('taskDueDate').value;
      const dueTime = document.getElementById('taskDueTime').value;
      const description = document.getElementById('taskDescription').value.trim();
      
      if (!title) {
        alert('Please enter a task title');
        return;
      }
      
      const task = {
        id: Date.now(),
        title,
        category,
        priority,
        dueDate,
        dueTime,
        description,
        completed: false,
        createdAt: new Date().toISOString()
      };
      
      tasks.push(task);
      
      // Clear inputs
      document.getElementById('taskInput').value = '';
      document.getElementById('taskDescription').value = '';
      document.getElementById('taskDueDate').value = '';
      document.getElementById('taskDueTime').value = '';
      
      renderTasks();
      updateStat('tasks');
      saveData();
    }
    
    function filterTasks(filter) {
      currentFilter = filter;
      
      // Update active button
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.filter === filter) {
          btn.classList.add('active');
        }
      });
      
      renderTasks();
    }
    
    function renderTasks() {
      const list = document.getElementById('taskList');
      
      // Filter tasks
      let filteredTasks = tasks;
      
      if (currentFilter === 'active') {
        filteredTasks = tasks.filter(t => !t.completed);
      } else if (currentFilter === 'completed') {
        filteredTasks = tasks.filter(t => t.completed);
      } else if (currentFilter === 'high') {
        filteredTasks = tasks.filter(t => t.priority === 'high' && !t.completed);
      } else if (currentFilter === 'homework' || currentFilter === 'project') {
        filteredTasks = tasks.filter(t => t.category === currentFilter);
      }
      
      if (filteredTasks.length === 0) {
        list.innerHTML = '<p class="text-white/60 text-center py-8">No tasks found for this filter.</p>';
        return;
      }
      
      // Sort by priority and due date
      filteredTasks.sort((a, b) => {
        const priorityOrder = { high: 0, medium: 1, low: 2 };
        if (a.completed !== b.completed) return a.completed ? 1 : -1;
        if (priorityOrder[a.priority] !== priorityOrder[b.priority]) {
          return priorityOrder[a.priority] - priorityOrder[b.priority];
        }
        if (a.dueDate && b.dueDate) return new Date(a.dueDate) - new Date(b.dueDate);
        return 0;
      });
      
      list.innerHTML = filteredTasks.map(task => {
        const categoryIcons = {
          homework: 'üìö',
          project: 'üéØ',
          study: 'üìñ',
          exam: 'üìù',
          other: 'üìå'
        };
        
        const priorityColors = {
          high: 'üî¥',
          medium: 'üü°',
          low: 'üü¢'
        };
        
        const dueDateTime = task.dueDate ? 
          `${new Date(task.dueDate).toLocaleDateString()}${task.dueTime ? ' ' + task.dueTime : ''}` : 
          'No due date';
        
        return `
          <div class="task-card priority-${task.priority} ${task.completed ? 'completed' : ''}">
            <div class="flex items-start gap-4">
              <input type="checkbox" ${task.completed ? 'checked' : ''} 
                     onchange="toggleTask(${task.id})"
                     class="w-6 h-6 rounded cursor-pointer mt-1">
              
              <div class="flex-1">
                <div class="flex items-center gap-2 mb-2">
                  <span class="text-2xl">${categoryIcons[task.category]}</span>
                  <h4 class="text-xl font-bold text-white ${task.completed ? 'line-through' : ''}">${task.title}</h4>
                  <span class="text-lg">${priorityColors[task.priority]}</span>
                </div>
                
                ${task.description ? `<p class="text-white/70 text-sm mb-2">${task.description}</p>` : ''}
                
                <div class="flex flex-wrap gap-3 text-sm text-white/60">
                  <span><i class="fas fa-calendar mr-1"></i>${dueDateTime}</span>
                  <span><i class="fas fa-tag mr-1"></i>${task.category}</span>
                  <span><i class="fas fa-flag mr-1"></i>${task.priority} priority</span>
                </div>
              </div>
              
              <button onclick="deleteTask(${task.id})" class="text-red-400 hover:text-red-300 text-xl">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        `;
      }).join('');
    }
    
    function toggleTask(id) {
      const task = tasks.find(t => t.id === id);
      if (task) {
        task.completed = !task.completed;
        renderTasks();
        saveData();
      }
    }
    
    function deleteTask(id) {
      if (confirm('Are you sure you want to delete this task?')) {
        tasks = tasks.filter(t => t.id !== id);
        renderTasks();
        saveData();
      }
    }
    
    // Notes
    let notes = [];
    
    function addNote() {
      const title = document.getElementById('noteTitle').value.trim();
      const content = document.getElementById('noteContent').value.trim();
      
      if (!title || !content) {
        alert('Please fill in both title and content');
        return;
      }
      
      notes.push({ 
        id: Date.now(), 
        title, 
        content, 
        date: new Date().toLocaleDateString() 
      });
      
      document.getElementById('noteTitle').value = '';
      document.getElementById('noteContent').value = '';
      renderNotes();
      saveData();
    }
    
    function renderNotes() {
      const list = document.getElementById('notesList');
      
      if (notes.length === 0) {
        list.innerHTML = '<p class="text-white/60 text-center py-8 col-span-full">No notes yet. Create one above!</p>';
        return;
      }
      
      list.innerHTML = notes.map(note => `
        <div class="glass-card hover:scale-105 transition">
          <div class="flex justify-between items-start mb-3">
            <h4 class="text-xl font-bold text-white">${note.title}</h4>
            <button onclick="deleteNote(${note.id})" class="text-red-400 hover:text-red-300">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <p class="text-white/80 mb-3">${note.content}</p>op
          <p class="text-white/50 text-sm">${note.date}</p>
        </div>
      `).join('');
    }
    
    function deleteNote(id) {
      notes = notes.filter(n => n.id !== id);
      renderNotes();
      saveData();
    }
    
    // ============================================
    // AI CONFIGURATION
    // ============================================
    const AI_CONFIG = {
      groq_key: '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',
      gemini_key: 'AIzaSyCvNcWubR1VZgBI0qhW2cK_wryMGlmeW-w'
    };
    
    let aiChatHistory = [];
    let aiVoiceEnabled = false;
    let aiRecognition = null;
    
    // Initialize SEPARATE AI voice recognition (different from main navigation voice)
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      aiRecognition = new SpeechRecognition();
      aiRecognition.continuous = false; // AI voice is one-shot
      aiRecognition.interimResults = false;
      aiRecognition.lang = 'en-US';
    }
    
    function toggleAIVoice() {
      aiVoiceEnabled = !aiVoiceEnabled;
      const btn = document.getElementById('aiVoiceBtn');
      if (aiVoiceEnabled) {
        btn.classList.add('bg-red-500');
        btn.classList.remove('bg-white/20');
      } else {
        btn.classList.remove('bg-red-500');
        btn.classList.add('bg-white/20');
      }
    }
    
    function startAIVoiceInput() {
      if (!aiRecognition) {
        alert('Voice recognition not supported. Try Chrome or Edge.');
        return;
      }
      
      // PAUSE main navigation voice while AI is listening
      const wasMainListening = isListening;
      if (isListening) {
        stopListening();
      }
      
      aiRecognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        document.getElementById('aiChatInput').value = transcript;
        sendAIChatMessage();
        
        // RESUME main navigation voice after AI input
        if (wasMainListening) {
          setTimeout(() => startListening(), 1000);
        }
      };
      
      aiRecognition.onerror = () => {
        // RESUME main navigation voice on error
        if (wasMainListening) {
          setTimeout(() => startListening(), 1000);
        }
      };
      
      aiRecognition.onend = () => {
        // RESUME main navigation voice when done
        if (wasMainListening) {
          setTimeout(() => startListening(), 1000);
        }
      };
      
      try {
        aiRecognition.start();
        showVoiceCommand('üé§ Ask your question...');
      } catch (e) {
        console.error('AI voice error:', e);
        if (wasMainListening) {
          setTimeout(() => startListening(), 1000);
        }
      }
    }
    
    // Safety check function
    function checkContentSafety(text) {
      const lowerText = text.toLowerCase();
      const inappropriate = ['violence', 'weapon', 'gun', 'bomb', 'drug', 'suicide', 'kill', 'hate'];
      const dangerous = ['make fire', 'make bomb', 'make poison', 'make weapon'];
      
      for (const word of [...inappropriate, ...dangerous]) {
        if (lowerText.includes(word)) return false;
      }
      return true;
    }
    
    function getSafetyResponse() {
      return "‚ö†Ô∏è Safety First! I can only help with safe, educational STEAM topics. Let's focus on learning! What would you like to know about science, math, technology, engineering, or arts?";
    }
    
    // Add message to chat
    function addAIChatMessage(message, sender = 'user') {
      const chat = document.getElementById('aiChatMessages');
      
      if (sender === 'user') {
        chat.innerHTML += `
          <div class="flex items-start gap-3 justify-end">
            <div class="glass-card max-w-2xl bg-white/20">
              <p class="text-white">${message}</p>
            </div>
            <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full flex items-center justify-center flex-shrink-0">
              <i class="fas fa-user text-white"></i>
            </div>
          </div>
        `;
      } else {
        // Format AI message with better styling
        const formatted = message
          .replace(/\*\*(.*?)\*\*/g, '<strong class="text-blue-300">$1</strong>')
          .replace(/\*(.*?)\*/g, '<em class="text-purple-300">$1</em>')
          .replace(/^‚Ä¢ (.+)$/gm, '<div class="flex gap-2 my-1"><span class="text-blue-400">‚Ä¢</span><span>$1</span></div>')
          .replace(/^(\d+)\. (.+)$/gm, '<div class="flex gap-2 my-1"><span class="text-purple-400 font-bold">$1.</span><span>$2</span></div>')
          .replace(/`([^`]+)`/g, '<code class="bg-black/40 px-2 py-1 rounded text-cyan-300 font-mono text-sm">$1</code>');
        
        chat.innerHTML += `
          <div class="flex items-start gap-3">
            <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center flex-shrink-0 animate-pulse">
              <i class="fas fa-robot text-white"></i>
            </div>
            <div class="glass-card max-w-2xl">
              <div class="text-white whitespace-pre-line leading-relaxed">${formatted}</div>
            </div>
          </div>
        `;
        
        // Text-to-Speech for AI responses
        if ('speechSynthesis' in window) {
          window.speechSynthesis.cancel();
          const cleanText = message.replace(/\*\*/g, '').replace(/\*/g, '').replace(/`/g, '');
          const utterance = new SpeechSynthesisUtterance(cleanText);
          utterance.rate = 1.1;
          utterance.pitch = 1.0;
          utterance.volume = 0.9;
          window.speechSynthesis.speak(utterance);
        }
      }
      
      chat.scrollTop = chat.scrollHeight;
    }
    
    function addAITypingIndicator() {
      const chat = document.getElementById('aiChatMessages');
      chat.innerHTML += `
        <div class="flex items-start gap-3" id="aiTyping">
          <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
            <i class="fas fa-robot text-white"></i>
          </div>
          <div class="glass-card">
            <div class="flex gap-1">
              <div class="w-2 h-2 bg-white rounded-full animate-bounce"></div>
              <div class="w-2 h-2 bg-white rounded-full animate-bounce" style="animation-delay: 0.2s;"></div>
              <div class="w-2 h-2 bg-white rounded-full animate-bounce" style="animation-delay: 0.4s;"></div>
            </div>
          </div>
        </div>
      `;
      chat.scrollTop = chat.scrollHeight;
    }
    
    function removeAITypingIndicator() {
      const typing = document.getElementById('aiTyping');
      if (typing) typing.remove();
    }
    
    // Get AI response
    async function getAIResponse(message) {
      if (!checkContentSafety(message)) {
        return getSafetyResponse();
      }
      
      aiChatHistory.push({ role: 'user', content: message });
      
      // Try Groq API
      if (AI_CONFIG.groq_key) {
        try {
          const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${AI_CONFIG.groq_key}`
            },
            body: JSON.stringify({
              model: 'llama-3.1-8b-instant',
              messages: [
                { 
                  role: 'system', 
                  content: `You are a helpful STEAM Lab assistant with access to inventory data. Answer questions about:
‚Ä¢ Science, Technology, Engineering, Arts, Mathematics
‚Ä¢ Lab inventory and equipment availability
‚Ä¢ What tools/materials are in stock

INVENTORY ACCESS: You can answer "Do we have X?" or "How many X do we have?" questions using this data:
- Arduino Kits: 26
- Microbit Kits: 17
- Servo Motors: 39
- DC Motors: 40
- TT Motors: 12
- Wheels: 100
- Alligator Clips: 500
- Switches: 20
- Sensors (moisture): 16
- Sensors (IR): 25
- Sensors (vibration): 55
- Sensors (motion): 5
- 3D Printers: 2 (Anycubic Kobra)
- Filament: 10 rolls
- VR Glasses: 10
- Glue sticks (small): 60
- Glue sticks (large): 50
- Batteries AA: 40
- Batteries AAA: 16
- Solar panels 6V: 10
- Solar panels 9V: 10

Use bullet points and keep responses under 200 words.`
                },
                ...aiChatHistory.slice(-6)
              ],
              max_tokens: 300,
              temperature: 0.7
            })
          });
          
          if (response.ok) {
            const data = await response.json();
            const aiResponse = data.choices[0].message.content;
            aiChatHistory.push({ role: 'assistant', content: aiResponse });
            return aiResponse;
          }
        } catch (error) {
          console.error('Groq API error:', error);
        }
      }
      
      // Fallback response
      return "I'm here to help with STEAM subjects! Ask me about:\n\n‚Ä¢ Science experiments and concepts\n‚Ä¢ Technology and coding\n‚Ä¢ Engineering projects\n‚Ä¢ Art techniques and history\n‚Ä¢ Mathematics problems and formulas\n\nWhat would you like to learn?";
    }
    
    // Send AI message
    async function sendAIChatMessage() {
      const input = document.getElementById('aiChatInput');
      const message = input.value.trim();
      
      if (!message) return;
      
      addAIChatMessage(message, 'user');
      input.value = '';
      
      addAITypingIndicator();
      
      try {
        const response = await getAIResponse(message);
        removeAITypingIndicator();
        addAIChatMessage(response, 'ai');
        updateStat('ai');
      } catch (error) {
        removeAITypingIndicator();
        addAIChatMessage('Sorry, I encountered an error. Please try again!', 'ai');
      }
    }
    
    // Stats & Data
    let stats = {
      experiments: 0,
      tasks: 0,
      ai: 0
    };
    
    function updateStat(type) {
      stats[type]++;
      const el = document.getElementById(`stat${type.charAt(0).toUpperCase() + type.slice(1)}`);
      if (el) el.textContent = stats[type];
      updateDataChart();
      saveData();
    }
    
    // Data Chart
    let dataChart;
    
    function initDataChart() {
      const ctx = document.getElementById('dataChart').getContext('2d');
      dataChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Experiments', 'Tasks', 'AI Chats'],
          datasets: [{
            label: 'Activity Count',
            data: [0, 0, 0],
            backgroundColor: [
              'rgba(59, 130, 246, 0.7)',
              'rgba(16, 185, 129, 0.7)',
              'rgba(236, 72, 153, 0.7)'
            ],
            borderColor: [
              'rgba(59, 130, 246, 1)',
              'rgba(16, 185, 129, 1)',
              'rgba(236, 72, 153, 1)'
            ],
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              labels: { color: 'white', font: { size: 14 } }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: { color: 'white' },
              grid: { color: 'rgba(255,255,255,0.1)' }
            },
            x: {
              ticks: { color: 'white' },
              grid: { color: 'rgba(255,255,255,0.1)' }
            }
          }
        }
      });
    }
    
    function updateDataChart() {
      if (dataChart) {
        dataChart.data.datasets[0].data = [
          stats.experiments,
          stats.tasks,
          stats.ai
        ];
        dataChart.update();
      }
    }
    
    // Save/Load Data
    function saveData() {
      const data = { tasks, notes, stats };
      localStorage.setItem('steamLabData', JSON.stringify(data));
    }
    
    function loadData() {
      const saved = localStorage.getItem('steamLabData');
      if (saved) {
        const data = JSON.parse(saved);
        tasks = data.tasks || [];
        notes = data.notes || [];
        stats = data.stats || { experiments: 0, tasks: 0, ai: 0 };
        
        renderTasks();
        renderNotes();
        
        Object.keys(stats).forEach(key => {
          const el = document.getElementById(`stat${key.charAt(0).toUpperCase() + key.slice(1)}`);
          if (el) el.textContent = stats[key];
        });
        
        updateDataChart();
      }
    }
    
    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closePanel();
      if (e.ctrlKey && e.key === 's') {
        e.preventDefault();
        saveData();
        showVoiceCommand('Data saved! ‚úì');
      }
    });
    
    // Auto-save every 30 seconds
    setInterval(saveData, 30000);
    
    // ============================================
    // INVENTORY FUNCTIONS
    // ============================================
    function openInventorySheet(type) {
      // Extract the sheet ID from the embedded URL and convert to edit URL
      const sheetId = '1vT69V_82_1Z2HaTDU-gspsccpc4e3cnJ77mpEHmZ9aplSx_xdRSzr-Ygw7xnT1zraWwp_gYBs2spNqb';
      const baseUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/edit`;
      
      // Different sheet tabs (gid numbers - you may need to adjust these)
      const urls = {
        input: baseUrl + '#gid=0',  // First sheet tab
        borrow: baseUrl + '#gid=1', // Second sheet tab  
        warehouse: baseUrl + '#gid=2', // Third sheet tab
        check: baseUrl + '#gid=3'  // Fourth sheet tab
      };
      
      // Open in new tab
      window.open(urls[type] || baseUrl, '_blank');
      
      // Show notification
      const names = {
        input: 'Input Sheet',
        borrow: 'Borrow/Return Sheet',
        warehouse: 'Warehouses Sheet',
        check: 'Check Item Sheet'
      };
      showVoiceCommand(`Opening ${names[type]}...`);
    }
    
    // ============================================
    // PLAGIARISM CHECKER
    // ============================================
    async function checkPlagiarism() {
      const input = document.getElementById('plagiarismInput');
      const text = input.value.trim();
      
      if (!text) {
        showPlagiarismError('Please enter some text to check!');
        return;
      }
      
      if (text.length < 50) {
        showPlagiarismError('Please enter at least 50 characters for accurate checking.');
        return;
      }
      
      // Show loading
      document.getElementById('plagiarismLoading').classList.remove('hidden');
      document.getElementById('plagiarismResults').classList.add('hidden');
      document.getElementById('plagiarismError').classList.add('hidden');
      document.getElementById('plagiarismCheckBtn').disabled = true;
      
      try {
        console.log('Checking plagiarism with Groq API...');
        
        const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${AI_CONFIG.groq_key}`
          },
          body: JSON.stringify({
            model: 'llama-3.1-8b-instant',
            messages: [{
              role: 'system',
              content: 'You are a plagiarism detection assistant. Analyze text and return ONLY a JSON object with this structure: {"score": 15, "status": "Original", "sources": []}. If you detect similarities, add sources with title, url, similarity, and excerpt fields.'
            }, {
              role: 'user',
              content: `Analyze this text for plagiarism and return ONLY JSON:\n\n${text.substring(0, 1000)}`
            }],
            temperature: 0.3,
            max_tokens: 1000
          })
        });
        
        if (!response.ok) {
          const errorData = await response.json();
          console.error('API Error:', errorData);
          throw new Error(`API Error: ${errorData.error?.message || 'Unknown error'}`);
        }
        
        const data = await response.json();
        console.log('API Response:', data);
        
        let result;
        
        try {
          const content = data.choices[0].message.content;
          console.log('Content:', content);
          
          // Try to extract JSON
          const jsonMatch = content.match(/\{[\s\S]*\}/);
          if (jsonMatch) {
            result = JSON.parse(jsonMatch[0]);
          } else {
            // Fallback: create a basic result
            result = {
              score: 10,
              status: 'Analysis Complete',
              sources: []
            };
          }
        } catch (e) {
          console.error('Parse error:', e);
          // Fallback result
          result = {
            score: 5,
            status: 'Text analyzed - appears original',
            sources: []
          };
        }
        
        displayPlagiarismResults(result);
        
      } catch (err) {
        console.error('Plagiarism check error:', err);
        showPlagiarismError(`Error: ${err.message}. Please check your API key and try again.`);
      } finally {
        document.getElementById('plagiarismLoading').classList.add('hidden');
        document.getElementById('plagiarismCheckBtn').disabled = false;
      }
    }
    
    function displayPlagiarismResults(result) {
      const score = result.score || 0;
      const scoreEl = document.getElementById('plagiarismScore');
      const statusEl = document.getElementById('plagiarismStatus');
      const citationsEl = document.getElementById('plagiarismCitations');
      
      // Display score
      scoreEl.textContent = `${score}%`;
      
      // Set status and color
      if (score < 20) {
        scoreEl.className = 'text-8xl font-bold text-green-400 mb-4';
        statusEl.textContent = '‚úÖ Original Content';
      } else if (score < 50) {
        scoreEl.className = 'text-8xl font-bold text-yellow-400 mb-4';
        statusEl.textContent = '‚ö†Ô∏è Some Similarities Found';
      } else {
        scoreEl.className = 'text-8xl font-bold text-red-400 mb-4';
        statusEl.textContent = '‚ùå High Plagiarism Detected';
      }
      
      // Display citations
      citationsEl.innerHTML = '';
      
      if (result.sources && result.sources.length > 0) {
        result.sources.forEach((source, index) => {
          const citationDiv = document.createElement('div');
          citationDiv.className = 'bg-white/10 rounded-xl p-6 border-l-4 border-blue-400';
          citationDiv.innerHTML = `
            <h4 class="text-xl font-bold text-white mb-3">${index + 1}. ${source.title || 'Source ' + (index + 1)}</h4>
            <p class="text-white/80 mb-2"><strong>Excerpt:</strong> "${source.excerpt || 'N/A'}"</p>
            <p class="text-white/80 mb-3"><strong>URL:</strong> <a href="${source.url || '#'}" target="_blank" class="text-blue-300 hover:text-blue-200 underline">${source.url || 'N/A'}</a></p>
            <span class="inline-block bg-blue-500 text-white px-4 py-2 rounded-full font-bold">${source.similarity || '0'}% Similar</span>
          `;
          citationsEl.appendChild(citationDiv);
        });
      } else {
        citationsEl.innerHTML = `
          <div class="text-center py-8">
            <div class="text-6xl mb-4">‚úÖ</div>
            <h3 class="text-2xl font-bold text-white mb-2">No Citations Found</h3>
            <p class="text-white/70">Your text appears to be original!</p>
          </div>
        `;
      }
      
      document.getElementById('plagiarismResults').classList.remove('hidden');
    }
    
    function showPlagiarismError(message) {
      const errorEl = document.getElementById('plagiarismError');
      errorEl.querySelector('p').textContent = message;
      errorEl.classList.remove('hidden');
      setTimeout(() => {
        errorEl.classList.add('hidden');
      }, 5000);
    }
    
    function clearPlagiarism() {
      document.getElementById('plagiarismInput').value = '';
      document.getElementById('plagiarismResults').classList.add('hidden');
      document.getElementById('plagiarismError').classList.add('hidden');
      document.getElementById('plagiarismLoading').classList.add('hidden');
    }
  </script>
</body>
</html>
